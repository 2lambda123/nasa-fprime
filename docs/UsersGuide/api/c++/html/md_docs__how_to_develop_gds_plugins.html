<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: How-To: F´ GDS Plugin Development</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">devel</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs__how_to_develop_gds_plugins.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How-To: F´ GDS Plugin Development </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This guide will walk through the process of developing GDS plugins. GDS plugins allow users to select an implementation for key functions within the GDS. These selections allow users to tailor the behavior of the GDS without affecting the top-level flow of data throughout the system.</p>
<h1><a class="anchor" id="autotoc_md230"></a>
Plugin System Design</h1>
<p>GDS plugins are built on top of the <a href="https://pluggy.readthedocs.io/en/stable/">pluggy</a>. This means that each implementor of a GDS plugin must define a function for behavior and mark that function with an implementation decorator.</p>
<p>The GDS defines several categories of plugins that the user may implement:</p>
<ol type="1">
<li>Framing plugins: used to change the framing of uplink and downlink packets</li>
<li>Communication plugins: used to change the interface for reading bytes from the spacecraft</li>
</ol>
<p>Plugins should define a function called <code>register_&lt;category&gt;_plugin</code> that would return a concrete subclass of the category's virtual-class that performs the work of the plugin. These classes may define <code>get_arguments</code>, <code>get_name</code>, and <code>check_arguments</code> functions used by the plugin system to provide and validate arguments from the CLI.</p>
<p>This guide will walk through the development of a framing plugin.</p>
<h1><a class="anchor" id="autotoc_md231"></a>
Developing a Framing Plugin</h1>
<p>The first step in developing a framing plugin is to determine the function that must be implemented and the class that must be derived to develop the plugin. This information is available in <a href="https://github.com/fprime-community/fprime-gds/blob/devel/src/fprime_gds/plugin/definitions.py"><code>fprime_gds.plugin.definitions</code></a>.</p>
<p>For the case of a <code>framing</code> plugin, the <code>register_framing_plugin</code> function contains the needed information: our function must be named <code>register_framing_plugin</code> and return a concrete subclass of <code>FramerDeframer</code>.</p>
<div class="fragment"><div class="line">@gds_plugin_specification</div>
<div class="line">def register_framing_plugin() -&gt; Type[&quot;FramerDeframer&quot;]:</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md232"></a>
Basic Plugin Skeleton</h2>
<p>Most GDS plugins define a class that inherits from the necessary virtual-class and implements virtual functions. These classes also define a properly decorated class method for the registration function, and may define the other class methods used for CLI interaction.</p>
<p>A basic framing plugin skeleton would thus look like: **<code>src/my_plugin.py</code>:** </p><div class="fragment"><div class="line">from fprime_gds.common.communication.framing import FramerDeframer</div>
<div class="line">from fprime_gds.plugin.definitions import gds_plugin_implementation</div>
<div class="line"> </div>
<div class="line">class MyPlugin(FramerDeframer):</div>
<div class="line">    # TODO: implement virtual functions</div>
<div class="line">    @classmethod</div>
<div class="line">    def get_name(cls):</div>
<div class="line">        &quot;&quot;&quot; Name of this implementation provided to CLI &quot;&quot;&quot;</div>
<div class="line">        return &quot;my-plugin&quot;</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    def get_arguments(cls):</div>
<div class="line">        &quot;&quot;&quot; Arguments to request from the CLI &quot;&quot;&quot;</div>
<div class="line">        return {}</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    def check_arguments(cls):</div>
<div class="line">        &quot;&quot;&quot; Check arguments from the CLI &quot;&quot;&quot;</div>
<div class="line">        pass</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    @gds_plugin_implementation</div>
<div class="line">    def register_framing_plugin(cls):</div>
<div class="line">        &quot;&quot;&quot; Register the MyPlugin plugin &quot;&quot;&quot;</div>
<div class="line">        return cls</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md233"></a>
Implementing Virtual Functions</h2>
<p>Each plugin virtual-class (e.g. <code>FramerDeframer</code>) has a set of virtual methods that plugin implementors <em>must</em> implement in order to support the plugin implementation. These functions are marked as <code>@abc.abstractmethod</code> and can be found in the virtual class definition.</p>
<p><a href="https://github.com/fprime-community/fprime-gds/blob/devel/src/fprime_gds/common/communication/framing.py#L29-L51">FramerDeframer virtual functions</a> consist of a <code>frame</code> and <code>deframe</code> method. This guide will use no-op functions.</p>
<p>**<code>src/my_plugin.py</code>:** </p><div class="fragment"><div class="line">from fprime_gds.common.communication.framing import FramerDeframer</div>
<div class="line">from fprime_gds.plugin.definitions import gds_plugin_implementation</div>
<div class="line"> </div>
<div class="line">class MyPlugin(FramerDeframer):</div>
<div class="line"> </div>
<div class="line">    def frame(self, data):</div>
<div class="line">        &quot;&quot;&quot; Frames data by no-op &quot;&quot;&quot;</div>
<div class="line">        return b&quot;&quot; + data # Forces a copy</div>
<div class="line"> </div>
<div class="line">    def deframe(self, data, no_copy=False):</div>
<div class="line">        &quot;&quot;&quot; Deframe data by no-op &quot;&quot;&quot;</div>
<div class="line">        if no_copy:</div>
<div class="line">            return data</div>
<div class="line">        return b&quot;&quot; + data # Forces a copy</div>
<div class="line">        </div>
<div class="line">    @classmethod</div>
<div class="line">    def get_name(cls):</div>
<div class="line">        &quot;&quot;&quot; Name of this implementation provided to CLI &quot;&quot;&quot;</div>
<div class="line">        return &quot;my-plugin&quot;</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    def get_arguments(cls):</div>
<div class="line">        &quot;&quot;&quot; Arguments to request from the CLI &quot;&quot;&quot;</div>
<div class="line">        return {}</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    def check_arguments(cls):</div>
<div class="line">        &quot;&quot;&quot; Check arguments from the CLI &quot;&quot;&quot;</div>
<div class="line">        pass</div>
<div class="line"> </div>
<div class="line">    @classmethod</div>
<div class="line">    @gds_plugin_implementation</div>
<div class="line">    def register_framing_plugin(cls):</div>
<div class="line">        &quot;&quot;&quot; Register the MyPlugin plugin &quot;&quot;&quot;</div>
<div class="line">        return cls</div>
</div><!-- fragment --><p>This is the basic implementation of a no-argument framing plugin. Next, this guide will cover how to integrate this plugin via python packaging. Then arguments will be covered.</p>
<h2><a class="anchor" id="autotoc_md234"></a>
Distributing Plugins</h2>
<p>Plugins are supplied as python packages with an entrypoint used to load the plugin. In the root of the package a basic python package will need to be configured. This consists of two files: pyproject.toml representing the package, and setup.py for backwards compatibility.</p>
<p>The project structure should look like: </p><div class="fragment"><div class="line">src/my_plugin.py</div>
<div class="line">pyproject.toml</div>
<div class="line">setup.py</div>
</div><!-- fragment --><p>A sample pyproject.toml file would look like:</p>
<div class="fragment"><div class="line">[build-system]</div>
<div class="line">requires = [&quot;setuptools&quot;, &quot;setuptools_scm[toml]&gt;=6.2&quot;, &quot;wheel&quot;]</div>
<div class="line">build-backend = &quot;setuptools.build_meta&quot;</div>
<div class="line"> </div>
<div class="line">[project]</div>
<div class="line">name = &quot;fprime-gds-my-plugin&quot;</div>
<div class="line">dynamic = [&quot;version&quot;]</div>
<div class="line">dependencies = [</div>
<div class="line">    &quot;pluggy&gt;=1.3.0&quot;,</div>
<div class="line">    &quot;fprime-gds&gt;=3.4.4&quot;</div>
<div class="line">]</div>
<div class="line"> </div>
<div class="line">[project.entry_points.&quot;fprime_gds&quot;]</div>
<div class="line">my_plugin = &quot;my_plugin:MyPlugin&quot;</div>
<div class="line"> </div>
<div class="line">[tool.setuptools_scm]</div>
</div><!-- fragment --><p>A sample <code>setup.py</code> would look like: </p><div class="fragment"><div class="line">from setuptools import setup</div>
<div class="line"> </div>
<div class="line"># Configuration is in pyproject.toml</div>
<div class="line">setup()</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
